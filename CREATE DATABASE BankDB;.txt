CREATE DATABASE BankDB;
USE BankDB;

CREATE TABLE Customer (
customer_id BIGINT,
nameSTRING,
email STRING
)
ROWFORMATDELIMITED
FIELDS TERMINATED BY ','
STORED ASTEXTFILE;


CREATE TABLE Account (
account_id BIGINT,
customer_id BIGINT,
balance DECIMAL(12,2)
)
PARTITIONED BY (branch_id INT)
ROWFORMATDELIMITED
FIELDS TERMINATED BY ','
STORED ASTEXTFILE;


CREATE TABLE Transaction (
transaction_id BIGINT,
account_id BIGINT,
amount DECIMAL(12,2)
)
PARTITIONED BY (branch_id INT)
ROWFORMATDELIMITED
FIELDS TERMINATED BY ','
STORED ASTEXTFILE;



CREATE TABLE Customer_tmp (
  customer_id BIGINT,
  name STRING,
  email STRING
)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ','
STORED AS TEXTFILE;




CREATE TABLE Account_tmp (
  account_id BIGINT,
  customer_id BIGINT,
  branch_id INT,
  balance DECIMAL(12,2)
)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ','
STORED AS TEXTFILE;




CREATE TABLE Transaction_tmp (
  transaction_id BIGINT,
  account_id BIGINT,
  branch_id INT,
  amount DECIMAL(12,2)
)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ','
STORED AS TEXTFILE;








LOAD DATA LOCAL INPATH '/tmp/Customer.csv' INTO TABLE Customer_tmp;

INSERT INTO TABLE Customer
SELECT * FROM Customer_tmp;


SELECT * FROM Customer;


LOAD DATA LOCAL INPATH '/tmp/Account.csv' INTO TABLE Account_tmp;

INSERT INTO TABLE Account PARTITION (branch_id)
SELECT account_id, customer_id, balance, branch_id FROM Account_tmp;

SELECT * FROM Account;


LOAD DATA LOCAL INPATH '/tmp/Transaction.csv' INTO TABLE Transaction_tmp;

INSERT INTO TABLE Transaction PARTITION (branch_id)
SELECT transaction_id, account_id, amount, branch_id FROM Transaction_tmp;



SELECT * FROM Transaction;






DROP TABLE Customer_tmp;
DROP TABLE Account_tmp;
DROP TABLE Transaction_tmp;



-- ============================================
-- Question 1(c): Add Partition (branch_id=6)
-- ============================================

ALTER TABLE Account ADD IF NOT EXISTS PARTITION (branch_id=6);
ALTER TABLE Transaction ADD IF NOT EXISTS PARTITION (branch_id=6);


-- ============================================
-- Question 1(d): Drop Partition (branch_id=3)
-- ============================================

ALTER TABLE Account DROP IF EXISTS PARTITION (branch_id=3);
ALTER TABLE Transaction DROP IF EXISTS PARTITION (branch_id=3);


-- ============================================
-- Question 1(e): Show Number of Transactions in Each Partition
-- ============================================

SELECT 
    branch_id,
    COUNT(*) as transaction_count
FROM Transaction
GROUP BY branch_id
ORDER BY branch_id;

-- Alternative: Show partition information with record counts
SHOW PARTITIONS Transaction;

-- Detailed partition statistics
SELECT 
    branch_id,
    COUNT(*) as num_transactions,
    SUM(amount) as total_amount,
    AVG(amount) as avg_amount,
    MIN(amount) as min_amount,
    MAX(amount) as max_amount
FROM Transaction
GROUP BY branch_id
ORDER BY branch_id;




DESC table_name;